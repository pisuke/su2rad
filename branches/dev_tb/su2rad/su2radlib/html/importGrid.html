<!--
	Copyright 2006 Google Inc.

	Licensed under the Apache License, Version 2.0 (the "License");
	you may not use this file except in compliance with the License.
	You may obtain a copy of the License at

	  http://www.apache.org/licenses/LICENSE-2.0

	Unless required by applicable law or agreed to in writing, software
	distributed under the License is distributed on an "AS IS" BASIS,
	WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
	See the License for the specific language governing permissions and
	limitations under the License.
-->
<html>
    <head>
        <title>TEST ImportField - Canvas TEST</title>
        
        <!-- log panel for debugging -->
        <script type="text/javascript" src="./blackbirdjs/blackbird.js"></script>
        
        <!-- jquery and plugins -->
        <script type="text/javascript" src="./js/lib/jquery-1.2.6.js"></script>
        <script type="text/javascript" src="./js/lib/jquery.alphanumeric.js"></script>
        <script type="text/javascript" src="./js/lib/jquery.filetree.js"></script>
        <script type="text/javascript" src="./js/lib/jqModal.js"></script>
        
        <!--[if IE]><script type="text/javascript" src="./js/lib/excanvas.js"></script><![endif]-->
        <script type="text/javascript" src="./js/lib/canvas.text.js"></script>
        <script type="text/javascript" src="./js/lib/faces/arial-normal-normal.js"></script>
          
        <!-- su2rad specific javascript files -->
        <script type="text/javascript" src="./js/su2rad.dialog.common.js"></script>
        <script type="text/javascript" src="./js/su2rad.fileselector.js"></script>
        <script type="text/javascript" src="./js/su2rad.gridCanvas.js"></script>
        
        <script type="text/javascript">
            // set environment
            if (navigator.userAgent.indexOf("Windows") != -1) {
                var PATHSEP = "/";    // helps with file handling in Ruby
                var PLATFORM = "Windows";
            } else {
                var PATHSEP = "/";
                var PLATFORM = "Mac";
            }
            var SKETCHUP = false;
            
            // relevant for grid 
            var canvas, ctx, gArray;

            function load() {
                //document.getElementById('messagearea').value = '';
                gCanvas = new GridCanvas();
                gCanvas.setCanvasId('cv');
                regenGrid();
            }

            function regenGrid() {
                document.getElementById('messagearea').value = '';
                gArray = new GridArray();
                gArray.generate();
                gCanvas.setArray(gArray);
                gCanvas.setLegend('right');
                gCanvas.draw();
                updateUI();
                showStats();
            }
            
            function logError(e) {
                log.error(e.toString())
                log.error("e.name " + e.name)
                log.error("e.message " + e.message)
                log.error("e.fileName " + e.fileName)
                log.error("e.lineNumber " + e.lineNumber)
            }
            
            function setLegendMax(v) {
                var value = parseFloat(v)
                if ( ! isNaN(value) ) {
                    gCanvas.setLegendMax(value)
                }
                updateUI()
            }
            
            function setLegendMin(v) {
                var value = parseFloat(v)
                if ( ! isNaN(value) ) {
                    gCanvas.setLegendMin(value)
                }
                updateUI()
            }
            
            function setLegendSteps(v) {
                var value = parseFloat(v)
                if ( ! isNaN(value) ) {
                    gCanvas.setLegendSteps(value)
                }
                updateUI()
            }
            
            function showStats() {
                statsDiv = document.getElementById('statsTable');
                while (statsDiv.hasChildNodes() == true) {
                    statsDiv.removeChild(statsDiv.firstChild)
                }
                var stats = gArray.getStats();
                var keys = ['average', 'uniform', 'minValue', 'maxValue', 'values', 'median'];
                for (i=0; i<keys.length; i++) {
                    var k = "stats_" + keys[i];
                    var row = document.createElement('div');
                    row.setAttribute('class', "gridRow")
                    var label = document.createElement('span');
                    // TODO: add span style
                    label.setAttribute('class', "gridLabel")
                    var ltxt = document.createTextNode(keys[i]);
                    label.appendChild(ltxt);
                    row.appendChild(label);
                    var value = document.createElement('span');
                    // TODO: add span style
                    var v = stats[keys[i]];
                    if ( keys[i] == "values" ) {
                        v = v.toFixed()
                    } else {
                        v = v.toFixed(2)
                    }
                    var vtxt = document.createTextNode(v);
                    value.appendChild(vtxt);
                    row.appendChild(value);
                    statsDiv.appendChild(row);
                }
            }
            
            function updateUI() {
                log.debug("updateUI()")
                var opts = gCanvas.getLegendOptions();
                document.getElementById("legendMinInput").value = opts.minValue.toFixed(2);
                document.getElementById("legendMaxInput").value = opts.maxValue.toFixed(2);
                document.getElementById("legendStepsInput").value = opts.steps.toFixed();
            }
            
            $().ready(function() {
                $('#fileSelectorWindow').jqm();
                $('#fileSelectorWindow').jqmAddTrigger('.selectButton');
            });


        </script>
        
        <link rel="stylesheet" href="./blackbirdjs/blackbird.css" type="text/css" media="screen">
        <link rel="stylesheet" href="./css/dialog.css"            type="text/css" media="print, projection, screen">
        <link rel="stylesheet" href="./css/jqModal.css"           type="text/css" media="screen">
        <link rel="stylesheet" href="./css/jquery.tabs.css"       type="text/css" media="print, projection, screen">
        <link rel="stylesheet" href="./css/jquery.filetree.css"   type="text/css"  media="screen" />
        <!-- Additional IE/Win specific style sheet (Conditional Comments) -->
        <!--[if lte IE 8]>
        <link rel="stylesheet" href="./css/jquery.tabs-ie.css" type="text/css" media="projection, screen">
        <link rel="stylesheet" href="./css/dialog-ie.css" type="text/css" media="print, projection, screen">
        <![endif]-->
        
        <style>
            canvas {
                border:1px solid #444;
                float: left;
            }
	</style>
</head>
    <body onload="load();">
    
        <!-- file selector popup -->
        <div class="jqmWindow2" id="fileSelectorWindow">
            <h3>Select file ...</h3>
            <div id="fileSelectorTree" class="fileSelector"></div>
            <div id="fileSelectorNote">selected: </div>
            <input class="exportbutton" type="button" id="fileSelectorButtonSelect" value="select file" onclick="fileSelector.select()" disabled>
            <input class="exportbutton" type="button" id="fileSelectorButtonCancel" value="cancel" onclick="fileSelector.close()">
        </div>
        
        <!-- show log button (top right) -->
        <input type="button" id="showLogButton" name="showLogButton" value="log" onclick="log.toggle()">
        
        <!-- show log button (top right) -->
        <h3 style="margin-top: 20px;">test canvas</h3>

        
        <!-- the canvas -->
        <canvas id="cv" width="600" height="400"></canvas>
        
        <!-- graph options -->
        <div id="graphOptionsPanel">
            <div class="gridRow">
                <input type="button" style="width: 135px;" id="loadTraceFile" name="loadTracFile" value="load file" onclick="fileSelector.show('.')">
            </div>
            <div> 
                <div class="gridRow" style="background-color: lightblue;">
                    <span class="gridLabel" style="width: 130px">legend options</span>
                </div>
                <div class="gridRow">
                    <span class="gridLabel">min value</span>
                    <span>
                        <input type="text" style="width:50px;" width="10" value="10" name="legendMinInput" id="legendMinInput" onchange="setLegendMin(this.value)"/>
                    </span>
                </div>
                <div class="gridRow">
                    <span class="gridLabel">max value</span>
                    <span>
                        <input type="text" style="width:50px;" width="10" value="10" name="legendMaxInput" id="legendMaxInput" onchange="setLegendMax(this.value)"/>
                    </span>
                </div>
                <div class="gridRow">
                    <span class="gridLabel">steps</span>
                    <span>
                        <input type="text" style="width:50px;" width="5" value="10" name="legendStepsInput" id="legendStepsInput" onchange="setLegendSteps(this.value)"/>
                    </span>
                </div>
            </div>
            <div> 
                <div class="gridRow" style="background-color: lightblue;">
                    <span class="gridLabel">statistics</span>
                </div>
            </div>
            
            <div id="statsTable"></div>
            <div class="gridRow">
                <input type="button" style="width: 135px;" id="loadTraceFile" name="loadTracFile" value="new grid" onclick="regenGrid()">
            </div>
        </div>
        
        <!-- for debugging -->
        <textarea id="messagearea" name="messagearea" cols=80 rows=8>foo</textarea>
        
</body>
</html>
